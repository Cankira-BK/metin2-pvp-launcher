<?php    /**     * Created by PhpStorm.     * User: user     * Date: 02.05.2017     * Time: 12:29     */    use Model\IN_Model;    class ProfileModel extends IN_Model    {        public function index()        {            $id = Session::get('adId');            return $this->db->select()->table('user')->where(array('id'=>$id))->get()[0];        }        public function password()        {            $id = Session::get('adId');            $oldPass = $this->filter->passwordFilter($_POST['oldPass']);            $newPass = $this->filter->passwordFilter($_POST['newPass']);            $reNewPass = $this->filter->passwordFilter($_POST['reNewPass']);            if ($oldPass == false || $newPass == false || $reNewPass == false ){                $result['result'] = false;                $result['message'] = 'Lütfen tüm alanları doldurunuz.';            }else{                if ($oldPass == '' || $newPass == '' || $reNewPass == ''){                    $result['result'] = false;                    $result['message'] = 'Lütfen tüm alanları doldurunuz.';                }else{                    if ($newPass != $reNewPass){                        $result['result'] = false;                        $result['message'] = 'Şifreler Uyuşmuyor';                    }else{                        $password = $this->hash->create('md5',$oldPass,HASH_PASSWORD_KEY);                        if (ADMINHASH == true){							$control = $this->db->select('id')->table('user')->where(array('password'=>$password,'id'=>$id))->count();                        }else{							$control = $this->db->select('id')->table('user')->where(array('password'=>$oldPass,'id'=>$id))->count();						}						if ($control < 1){                            $result['result'] = false;                            $result['message'] = 'Mevcut Şifreyi Yanlış Girdiniz';                        }else{                            $newPassword = $this->hash->create('md5',$newPass,HASH_PASSWORD_KEY);							if (ADMINHASH == true){								$this->db->update('user',array('password'=>$newPassword),array('id'=>$id));							}else{								$this->db->update('user',array('password'=>$newPass),array('id'=>$id));							}                            Functions::setAdminLog("$id ID'li Admin Şifresini Değiştirdi.");                            $result['message'] = 'Şifreniz Güncellendi';                            $result['result'] = true;                        }                    }                }            }            echo json_encode($result);        }        public function change()        {            $name = $this->filter->mainFilter($_POST['name']);            if ($name == false){                $result['result'] = false;                $result['message'] = 'Lütfen Türkçe Karakter Kullanmayınız';            }else{                $id = Session::get('adId');                $control = $this->db->select('id,name,imza')->table('user')->where(array('id'=>$id))->get()[0];                $nameOld = $control['name'];                $imza = $control['imza'];                $signature = filter_var($_POST["signature"],FILTER_SANITIZE_STRING);                if ($name == $nameOld && $imza == $signature){                    $result['result'] = false;                    $result['message'] = 'Herhangi Bir Değişiklik Yapılmadı';                }else{                    $this->db->update('user',array('name'=>$name,'imza'=>$signature),array('id'=>$id));                    $result['result'] = true;                    $result['message'] = 'Bilgiler Başarıyla Güncellendi';                    Functions::setAdminLog("$id ID'li Admin İsmini Değiştirdi.");                    Session::set('aName',$name);                }            }            echo json_encode($result);        }        public function imageupload($arg)        {            if($_FILES){                $control = $this->db->select('id')->table('user')->where(array('id'=>$arg))->count();                if($control <= 0){                    $result['result'] = false;                    $result['message'] = 'empty';                }else{                    $logo = $_FILES['logo'];                    $up = $this->upload->image_upload($logo);                    if ($up["result"] == false){                        $result['result'] = false;                        $result['message'] = 'error';                    }else{                        $paths = $up['paths'];                        $this->db->update('user',array('avatar'=>$paths),array('id'=>$arg));                        Functions::setAdminLog("$arg ID'lı Admin Profil Resmini Değiştirdi.");                        $result['result'] = true;                        $result['message'] = $paths;                    }                }                echo json_encode($result);            }        }    }